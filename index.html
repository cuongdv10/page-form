<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ch·ªçn Fanpage ƒë·ªÉ ƒëƒÉng b√†i</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      padding: 2rem;
      background: #f9f9f9;
      color: #333;
    }
    h2 {
      text-align: center;
      color: #1d4ed8;
    }
    .platform-group {
      background: #fff;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .platform-title {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 0.5rem;
    }
    .checkbox-list label {
      display: block;
      margin: 0.4rem 0;
    }
    .submit-btn {
      display: block;
      width: 100%;
      background: #1d4ed8;
      color: white;
      border: none;
      padding: 0.75rem;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>üìù Ch·ªçn c√°c Fanpage ƒë·ªÉ ƒëƒÉng b√†i</h2>
  <form method="POST" id="pageForm">
    <div id="formContainer">ƒêang t·∫£i d·ªØ li·ªáu...</div>
    <input type="submit" class="submit-btn" value="Ti·∫øp t·ª•c">
  </form>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const apiUrl = `https://script.google.com/macros/s/AKfycbztNHrxAi2Gi5yyEYeES1iVbkZhKn6zTXuyepF1nSXfZDe2ntqn_i-65WXEnEwqvu9S/exec?resumeUrl=${urlParams.get('resumeUrl') || ''}`;

    fetch(apiUrl)
      .then(res => res.json())
      .then(({ pages }) => {
        const grouped = {};
        pages.forEach(p => {
          if (!grouped[p.platform]) grouped[p.platform] = [];
          grouped[p.platform].push(p);
        });

        const container = document.getElementById("formContainer");
        container.innerHTML = '';

        Object.entries(grouped).forEach(([platform, items]) => {
          const group = document.createElement("div");
          group.className = "platform-group";
          group.innerHTML = `<div class="platform-title">${platform}</div><div class="checkbox-list"></div>`;
          const list = group.querySelector(".checkbox-list");
          items.forEach(({ displayName, name, id }) => {
            const label = document.createElement("label");
            label.innerHTML = `<input type="checkbox" name="pages" value="${name}|${id}|${platform}"> ${displayName}`;
            list.appendChild(label);
          });
          container.appendChild(group);
        });
      })
      .catch(() => {
        document.getElementById("formContainer").innerHTML = '<div style="color:red">‚ùå Kh√¥ng th·ªÉ t·∫£i danh s√°ch page. H√£y ki·ªÉm tra l·∫°i k·∫øt n·ªëi!</div>';
      });
  </script>
</body>
</html>
